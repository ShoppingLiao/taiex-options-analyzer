<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>結算日預測報告 - {{ settlement_date }}</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --purple-color: #8b5cf6;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
            color: white;
            padding: 30px 20px;
            margin-bottom: 30px;
            border-radius: 12px;
            position: relative;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .settlement-info {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
        }

        .info-item {
            flex: 1;
        }

        .info-label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.3rem;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            header {
                text-align: center;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            .settlement-info {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* Section */
        .section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .section {
                padding: 20px 16px;
            }
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .section-icon {
            font-size: 1.8rem;
            margin-right: 12px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
        }

        /* Trend Overview */
        .trend-overview {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .trend-overview {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .trend-indicator {
            background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
            color: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }

        .trend-indicator.bullish {
            background: linear-gradient(135deg, var(--success-color), #16a34a);
        }

        .trend-indicator.bearish {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        .trend-indicator.neutral {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
        }

        .trend-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .trend-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .trend-strength {
            font-size: 1rem;
            opacity: 0.9;
        }

        .strength-stars {
            margin-top: 10px;
            font-size: 1.5rem;
        }

        /* Predicted Range */
        .predicted-range {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 12px;
            padding: 25px;
        }

        .range-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 15px;
        }

        .range-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .range-separator {
            color: var(--text-muted);
        }

        .current-price-badge {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 10px 20px;
            margin-top: 15px;
            text-align: center;
        }

        .current-price-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .current-price-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Trend Signals */
        .signals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .signal-card {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
        }

        .signal-card.bullish {
            border-left-color: var(--success-color);
        }

        .signal-card.bearish {
            border-left-color: var(--danger-color);
        }

        .signal-card.neutral {
            border-left-color: var(--warning-color);
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .signal-direction {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .signal-strength {
            background: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .signal-indicators {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .indicator-tag {
            background: white;
            color: var(--text-muted);
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
        }

        .signal-description {
            color: var(--text-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Scenarios */
        .scenarios-grid {
            display: grid;
            gap: 20px;
        }

        .scenario-card {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .scenario-card.primary {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .scenario-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .scenario-icon {
            font-size: 1.8rem;
        }

        .scenario-probability {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .scenario-range {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .range-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        .range-values {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .key-levels {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .level-badge {
            background: white;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .conditions-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .condition-item {
            padding: 6px 0;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .strategy-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 8px;
            padding: 15px;
            border-left: 3px solid var(--warning-color);
        }

        .strategy-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 5px;
        }

        .strategy-text {
            color: #78350f;
            font-size: 0.95rem;
        }

        /* Key Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .metric-change {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .metric-change.positive {
            color: var(--success-color);
        }

        .metric-change.negative {
            color: var(--danger-color);
        }

        /* Risks */
        .risks-list {
            display: grid;
            gap: 12px;
        }

        .risk-item {
            background: #fef2f2;
            border-left: 4px solid var(--danger-color);
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 0.95rem;
            color: #991b1b;
        }

        /* Header 回首頁按鈕 */
        .home-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .home-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* 手機版調整 */
        @media (max-width: 768px) {
            .home-button {
                position: static;
                display: inline-flex;
                margin-top: 15px;
            }
        }

        /* Footer */
        footer {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 30px;
        }

        .footer-links {
            margin-top: 10px;
        }

        .footer-links a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* Tabs */
        .tabs-container {
            background: white;
            border-radius: 16px;
            padding: 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs-header {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            background: var(--bg-color);
        }

        .tab-button {
            flex: 1;
            padding: 18px 24px;
            background: transparent;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(37, 99, 235, 0.05);
            color: var(--primary-color);
        }

        .tab-button.active {
            color: var(--primary-color);
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-color);
        }

        .tab-icon {
            margin-right: 8px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .tabs-header {
                flex-direction: column;
            }
            .tab-button {
                padding: 14px 20px;
                font-size: 1rem;
            }
        }

        /* AI Analysis Styles */
        .ai-intro {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-left: 4px solid var(--primary-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .ai-persona {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .ai-avatar {
            font-size: 3rem;
        }

        .ai-role {
            flex: 1;
        }

        .ai-role-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .ai-role-desc {
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .ai-note {
            background: white;
            border-radius: 8px;
            padding: 15px;
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-color);
        }

        .analysis-section {
            margin-bottom: 30px;
        }

        .analysis-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .analysis-block {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .block-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .block-content {
            font-size: 1rem;
            line-height: 1.8;
            color: var(--text-color);
        }

        .block-content p {
            margin-bottom: 15px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid var(--warning-color);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .highlight-box strong {
            color: #92400e;
        }

        .conclusion-box {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-left: 4px solid var(--primary-color);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .conclusion-box strong {
            color: #1e40af;
        }

        .price-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .price-level {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border-left: 3px solid;
        }

        .price-level.resistance {
            border-left-color: var(--danger-color);
        }

        .price-level.support {
            border-left-color: var(--success-color);
        }

        .level-label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .level-range {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .level-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .trading-tips {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .tips-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #991b1b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tip-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .tip-item strong {
            color: #991b1b;
        }

        .scenario-prediction {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .prediction-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border-color);
            transition: all 0.3s;
        }

        .prediction-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prediction-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .prediction-prob {
            background: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .prediction-detail {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-color);
        }

        /* ========================================
           手機版優化 - 超緊湊設計
           ======================================== */
        @media (max-width: 768px) {
            /* 全域設定 */
            body {
                padding: 5px 0;
                font-size: 0.85rem;
                line-height: 1.4;
            }

            .container {
                padding: 0 6px;
            }

            /* 標題區塊 - 縮減到原來的 40% */
            header {
                padding: 8px 10px;
                margin-bottom: 8px;
                border-radius: 6px;
                overflow: hidden;
            }

            h1 {
                font-size: 1.1rem !important;
                margin-bottom: 3px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .subtitle {
                font-size: 0.75rem;
                margin-bottom: 5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* 關鍵數據改為橫向滾動 */
            .settlement-info {
                display: flex !important;
                flex-direction: row !important;
                gap: 8px !important;
                margin-top: 6px !important;
                padding-top: 6px !important;
                font-size: 0.75rem !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                scrollbar-width: thin !important;
                padding-bottom: 4px !important;
            }

            .settlement-info::-webkit-scrollbar {
                height: 3px !important;
            }

            .settlement-info::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.1) !important;
            }

            .settlement-info::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3) !important;
                border-radius: 3px !important;
            }

            .info-item {
                flex: 0 0 auto !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                white-space: nowrap !important;
                min-width: fit-content !important;
            }

            .info-label {
                display: inline !important;
                font-size: 0.7rem !important;
                margin-bottom: 0 !important;
                margin-right: 3px !important;
                opacity: 0.8 !important;
            }

            .info-value {
                display: inline !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
            }

            .info-label::after {
                content: ":" !important;
            }

            /* Section 區塊 - 更緊湊 */
            .section {
                padding: 10px 8px;
                margin-bottom: 8px;
                border-radius: 8px;
            }

            .section-header {
                margin-bottom: 8px;
                padding-bottom: 6px;
            }

            .section-icon {
                font-size: 1.1rem;
                margin-right: 6px;
            }

            .section-title {
                font-size: 1rem !important;
            }

            /* Tab 改為 1x4 + 橫向滾動 */
            .tabs-container {
                margin-bottom: 8px;
            }

            .tabs-header {
                display: flex !important;
                flex-direction: row !important;
                overflow-x: auto !important;
                overflow-y: hidden !important;
                -webkit-overflow-scrolling: touch !important;
                scrollbar-width: thin !important;
                gap: 4px !important;
                padding: 4px !important;
            }

            .tabs-header::-webkit-scrollbar {
                height: 3px !important;
            }

            .tabs-header::-webkit-scrollbar-track {
                background: #f1f1f1 !important;
            }

            .tabs-header::-webkit-scrollbar-thumb {
                background: var(--primary-color) !important;
                border-radius: 3px !important;
            }

            .tab-button {
                flex: 0 0 auto !important;
                min-width: 100px !important;
                padding: 8px 12px !important;
                font-size: 0.85rem !important;
                border-radius: 6px 6px 0 0 !important;
            }

            .tab-icon {
                margin-right: 4px !important;
                font-size: 0.9rem !important;
            }

            /* 趨勢指標 - 緊湊版 */
            .trend-indicator {
                padding: 10px;
                border-radius: 6px;
            }

            .trend-label {
                font-size: 0.7rem;
                margin-bottom: 3px;
            }

            .trend-value {
                font-size: 1.2rem !important;
                margin-bottom: 3px;
            }

            .trend-strength {
                font-size: 0.7rem;
            }

            .strength-stars {
                margin-top: 3px;
                font-size: 1rem;
            }

            /* 預測區間 - 緊湊版 */
            .predicted-range {
                padding: 10px;
                border-radius: 6px;
            }

            .predicted-range h3 {
                font-size: 0.85rem;
                margin-bottom: 6px;
            }

            .price-display {
                font-size: 1.2rem !important;
                margin: 5px 0;
            }

            .range-bars {
                padding: 6px 10px;
                border-radius: 4px;
            }

            .range-bar .label {
                font-size: 0.7rem;
                margin-bottom: 2px;
            }

            .range-bar .value {
                font-size: 0.95rem;
            }

            /* 趨勢訊號 - 緊湊版 */
            .signal-item {
                padding: 8px;
                margin-bottom: 6px;
                border-radius: 6px;
            }

            .signal-strength {
                padding: 2px 6px;
                font-size: 0.65rem;
            }

            .signal-content {
                font-size: 0.8rem;
            }

            /* 劇本卡片 - 緊湊版 */
            .scenario-card {
                padding: 8px;
                border-radius: 6px;
            }

            .scenario-header {
                margin-bottom: 5px;
            }

            .scenario-name {
                font-size: 0.9rem;
            }

            .scenario-prob {
                font-size: 1.1rem !important;
                padding: 2px 0;
            }

            .scenario-prob-label {
                font-size: 0.65rem;
            }

            .scenario-range {
                padding: 5px;
                margin: 5px 0;
                border-radius: 4px;
            }

            .scenario-range div:first-child {
                font-size: 0.7rem;
                margin-bottom: 2px;
            }

            .scenario-range div:last-child {
                font-size: 0.95rem;
            }

            .scenario-strategy {
                padding: 5px;
                border-radius: 4px;
            }

            .scenario-strategy div:first-child {
                font-size: 0.7rem;
                margin-bottom: 2px;
            }

            .scenario-strategy div:last-child {
                font-size: 0.8rem;
            }

            /* 風險提示 - 緊湊版 */
            .risk-item {
                padding: 6px 8px;
                margin-bottom: 5px;
                font-size: 0.8rem;
            }

            .risk-icon {
                font-size: 1.1rem;
                margin-right: 5px;
            }

            /* AI 預測績效總覽 - 單行顯示優化 */
            .stats-grid {
                gap: 5px !important;
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .stat-card {
                padding: 6px 8px !important;
                border-radius: 6px !important;
                display: flex !important;
                flex-direction: row !important;
                align-items: center !important;
                justify-content: space-between !important;
            }

            .stat-card .label {
                font-size: 0.7rem !important;
                margin-bottom: 0 !important;
                margin-right: 5px !important;
                white-space: nowrap !important;
            }

            .stat-card .value {
                font-size: 1rem !important;
                font-weight: 700 !important;
            }

            .stat-card .unit {
                font-size: 0.7rem !important;
                margin-left: 2px !important;
            }

            /* 最佳預測記錄 - 單行優化 */
            .best-prediction-card {
                padding: 8px !important;
                border-radius: 6px !important;
            }

            .best-prediction-card h4 {
                font-size: 0.85rem !important;
                margin-bottom: 6px !important;
            }

            .best-prediction-grid {
                gap: 5px !important;
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .best-pred-item {
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
            }

            .best-pred-item .label {
                font-size: 0.7rem !important;
                margin-bottom: 0 !important;
                margin-right: 5px !important;
                white-space: nowrap !important;
            }

            .best-pred-item .value {
                font-size: 0.9rem !important;
                font-weight: 600 !important;
            }

            /* 通用卡片優化 - 單行顯示 */
            div[style*="padding: 25px"] {
                padding: 8px 10px !important;
            }

            div[style*="padding: 20px"] {
                padding: 6px 8px !important;
            }

            div[style*="padding: 30px"] {
                padding: 8px 10px !important;
            }

            div[style*="padding: 15px"] {
                padding: 5px 8px !important;
            }

            /* 字體大小限制 - 更小 */
            h2[style*="font-size: 1.8rem"],
            h2[style*="font-size: 2rem"] {
                font-size: 1.1rem !important;
            }

            h3[style*="font-size: 1.5rem"],
            h3[style*="font-size: 1.6rem"],
            h3[style*="font-size: 1.8rem"] {
                font-size: 1rem !important;
            }

            div[style*="font-size: 1.5rem"],
            span[style*="font-size: 1.5rem"] {
                font-size: 1rem !important;
            }

            div[style*="font-size: 1.8rem"],
            span[style*="font-size: 1.8rem"] {
                font-size: 1.1rem !important;
            }

            div[style*="font-size: 2rem"],
            span[style*="font-size: 2rem"] {
                font-size: 1.2rem !important;
            }

            div[style*="font-size: 2.5rem"],
            span[style*="font-size: 2.5rem"] {
                font-size: 1.3rem !important;
            }

            div[style*="font-size: 3rem"],
            span[style*="font-size: 3rem"] {
                font-size: 1.3rem !important;
            }

            /* 內容文字 */
            p[style*="font-size: 1.1rem"] {
                font-size: 0.85rem !important;
            }

            p[style*="font-size: 1.2rem"] {
                font-size: 0.9rem !important;
            }

            p[style*="font-size: 1.3rem"] {
                font-size: 0.95rem !important;
            }

            /* 留白優化 - 極致緊湊 */
            div[style*="margin-bottom: 30px"],
            div[style*="margin-bottom: 25px"] {
                margin-bottom: 8px !important;
            }

            div[style*="margin-bottom: 20px"],
            div[style*="margin-bottom: 15px"] {
                margin-bottom: 6px !important;
            }

            div[style*="margin-bottom: 10px"] {
                margin-bottom: 4px !important;
            }

            div[style*="margin: 20px 0"],
            div[style*="margin: 15px 0"] {
                margin: 6px 0 !important;
            }

            div[style*="gap: 30px"] {
                gap: 8px !important;
            }

            div[style*="gap: 25px"] {
                gap: 6px !important;
            }

            div[style*="gap: 20px"] {
                gap: 5px !important;
            }

            div[style*="gap: 15px"] {
                gap: 5px !important;
            }

            /* 結算策略建議優化 */
            div[style*="border-left: 4px solid"] {
                padding: 6px 8px !important;
                margin-bottom: 5px !important;
            }

            div[style*="border-left: 4px solid"] > div[style*="font-size: 1.05rem"],
            div[style*="border-left: 4px solid"] > div[style*="font-size: 0.95rem"] {
                font-size: 0.85rem !important;
                margin-bottom: 4px !important;
            }

            div[style*="border-left: 4px solid"] > div[style*="color: #78350f"],
            div[style*="border-left: 4px solid"] > div[style*="color: #dc2626"] {
                font-size: 0.75rem !important;
                margin-bottom: 3px !important;
                line-height: 1.3 !important;
            }

            /* 結算展望 */
            div[style*="white-space: pre-line"] {
                font-size: 0.8rem !important;
                line-height: 1.5 !important;
                padding: 8px !important;
            }

            /* 交易員視角 - 關鍵數據單行顯示 */
            div[style*="background: white"][style*="text-align: center"] {
                display: flex !important;
                flex-direction: row !important;
                align-items: center !important;
                justify-content: space-between !important;
                text-align: left !important;
                padding: 5px 8px !important;
            }

            div[style*="background: white"][style*="text-align: center"] > div {
                display: inline !important;
                margin-bottom: 0 !important;
            }

            div[style*="background: white"][style*="text-align: center"] > div:first-child::after {
                content: ":" !important;
                margin: 0 3px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <a href="index.html" class="home-button">
                <span>🏠</span>
                <span>回首頁</span>
            </a>
            <h1>🎯 結算日預測報告</h1>
            <p class="subtitle">Taiwan Stock Index Options Settlement Prediction</p>
            
            <div class="settlement-info">
                <div class="info-item">
                    <div class="info-label">結算日期</div>
                    <div class="info-value">{{ settlement_date_formatted }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">分析數據</div>
                    <div class="info-value">{{ analysis_dates_text }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">報告生成</div>
                    <div class="info-value">{{ generated_time }}</div>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-button active" onclick="switchTab('technical')">
                    <span class="tab-icon">📊</span>技術分析
                </button>
                <button class="tab-button" onclick="switchTab('ai-analysis')">
                    <span class="tab-icon">🤖</span>AI 操盤分析
                </button>
                <button class="tab-button" onclick="switchTab('trader-view')">
                    <span class="tab-icon">🧑‍💼</span>交易員視角
                </button>
                <button class="tab-button" onclick="switchTab('settlement-review')">
                    <span class="tab-icon">📝</span>盤後檢討
                </button>
            </div>
        </div>

        <!-- Technical Analysis Tab -->
        <div id="technical-tab" class="tab-content active">
        
        <!-- Trend Overview -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">📊</span>
                <h2 class="section-title">趨勢分析總覽</h2>
            </div>
            
            <div class="trend-overview">
                <div class="trend-indicator {{ overall_trend }}">
                    <div class="trend-label">整體趨勢</div>
                    <div class="trend-value">{{ overall_trend_text }}</div>
                    <div class="trend-strength">強度評級</div>
                    <div class="strength-stars">{{ strength_stars }}</div>
                </div>
                
                <div class="predicted-range">
                    <div class="range-title">預測結算區間</div>
                    <div class="range-display">
                        <span>{{ predicted_lower }}</span>
                        <span class="range-separator">～</span>
                        <span>{{ predicted_upper }}</span>
                    </div>
                    <div class="current-price-badge">
                        <div class="current-price-label">當前價格</div>
                        <div class="current-price-value">{{ current_price }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trend Signals -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">📡</span>
                <h2 class="section-title">趨勢訊號分析</h2>
            </div>
            
            <div class="signals-grid">
                {% for signal in trend_signals %}
                <div class="signal-card {{ signal.direction }}">
                    <div class="signal-header">
                        <div class="signal-direction">
                            <span>{{ signal.direction_icon }}</span>
                            <span>{{ signal.direction_text }}</span>
                        </div>
                        <div class="signal-strength">{{ signal.strength }}/5</div>
                    </div>
                    <div class="signal-indicators">
                        {% for indicator in signal.indicators %}
                        <span class="indicator-tag">{{ indicator }}</span>
                        {% endfor %}
                    </div>
                    <div class="signal-description">{{ signal.description }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Scenarios -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">🎬</span>
                <h2 class="section-title">結算劇本分析</h2>
            </div>
            
            <div class="scenarios-grid">
                {% for scenario in scenarios %}
                <div class="scenario-card {% if loop.index == 1 %}primary{% endif %}">
                    <div class="scenario-header">
                        <div class="scenario-name">
                            <span class="scenario-icon">{{ scenario.icon }}</span>
                            <span>{{ scenario.name }}</span>
                        </div>
                        <div class="scenario-probability">{{ scenario.probability }}%</div>
                    </div>
                    
                    <div class="scenario-range">
                        <div class="range-label">預測區間</div>
                        <div class="range-values">{{ scenario.range_lower }} ～ {{ scenario.range_upper }}</div>
                    </div>
                    
                    <div class="range-label">關鍵價位</div>
                    <div class="key-levels">
                        {% for level in scenario.key_levels %}
                        <span class="level-badge">{{ level }}</span>
                        {% endfor %}
                    </div>
                    
                    <div class="conditions-list">
                        <div class="range-label">成立條件</div>
                        {% for condition in scenario.conditions %}
                        <div class="condition-item">{{ condition }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="strategy-box">
                        <div class="strategy-label">💡 操作建議</div>
                        <div class="strategy-text">{{ scenario.strategy }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="section">
            <div class="section-header">
                <span class="section-icon">📈</span>
                <h2 class="section-title">關鍵指標</h2>
            </div>
            
            <div class="metrics-grid">
                {% for metric in key_metrics %}
                <div class="metric-card">
                    <div class="metric-label">{{ metric.label }}</div>
                    <div class="metric-value">{{ metric.value }}</div>
                    {% if metric.change %}
                    <div class="metric-change {{ metric.change_class }}">{{ metric.change }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Risks -->
        {% if risks %}
        <div class="section">
            <div class="section-header">
                <span class="section-icon">⚠️</span>
                <h2 class="section-title">風險提示</h2>
            </div>
            
            <div class="risks-list">
                {% for risk in risks %}
                <div class="risk-item">{{ risk }}</div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        </div>
        <!-- End Technical Analysis Tab -->

        <!-- AI Analysis Tab -->
        <div id="ai-analysis-tab" class="tab-content">
            
            <!-- AI Persona Introduction -->
            <div class="section">
                <div class="ai-intro">
                    <div class="ai-persona">
                        <div class="ai-avatar">👨‍💼</div>
                        <div class="ai-role">
                            <div class="ai-role-title">資深選擇權操盤手視角</div>
                            <div class="ai-role-desc">20年實戰經驗 | 專注台指選擇權結算日策略</div>
                        </div>
                    </div>
                    <div class="ai-note">
                        <strong>第一人稱視角：</strong>我是一位老練的選擇權操盤手，以下是我對本次結算日的深度分析。這不只是冷冰冰的數據，而是我多年來在市場廝殺累積的實戰經驗與判斷。
                    </div>
                </div>
            </div>

            <!-- Settlement Range Analysis -->
            <div class="section">
                <div class="analysis-section">
                    <h3 class="analysis-title">
                        <span>🎯</span>結算區間預測：莊家的「最佳利益點」
                    </h3>

                    <div class="analysis-block">
                        <div class="block-content">
                            <p>根據目前的 OI 籌碼圖和夜盤走勢，我看到了莊家（賣方）非常清晰的防線布局。在結算日這種關鍵時刻，市場不是隨機遊走，而是一場多空雙方的籌碼博弈。</p>
                        </div>
                    </div>

                    <div class="price-levels">
                        <div class="price-level resistance">
                            <div class="level-label" style="color: var(--danger-color);">🔴 上檔天花板</div>
                            <div class="level-range">{{ ai_resistance_range }}</div>
                            <div class="level-desc">
                                夜盤高點 {{ night_high }} 接近壓力區便拉回，這印證了 Call OI 大增的壓制力。<strong>除非早盤有極大利多，否則要結算在此之上的機率較低</strong>，因為莊家會全力守住這道防線以賺取 Call 的權利金。
                            </div>
                        </div>

                        <div class="price-level support">
                            <div class="level-label" style="color: var(--success-color);">🟢 下檔地板</div>
                            <div class="level-range">{{ ai_support_range }}</div>
                            <div class="level-desc">
                                夜盤低點 {{ night_low }} 守在此關卡之上，距離 Put OI 重兵區尚有空間。<strong>此位附近有支撐</strong>，若今日回測此位，通常會有買盤或莊家護盤。
                            </div>
                        </div>
                    </div>

                    <div class="conclusion-box">
                        <strong>我的判斷：</strong>結算價高機率落在 <strong>{{ ai_settlement_range }}</strong> 這個區間，讓兩邊的權利金最大程度被消耗。這是莊家的最佳利益點。
                    </div>
                </div>
            </div>

            <!-- P/C Ratio Analysis -->
            <div class="section">
                <div class="analysis-section">
                    <h3 class="analysis-title">
                        <span>📉</span>P/C Ratio 轉弱的實戰意義
                    </h3>

                    <div class="analysis-block">
                        <div class="block-content">
                            <p>昨天的 P/C Ratio 顯示 <strong>{{ pc_ratio_status }}</strong>，配合夜盤 {{ night_trend }}，這代表：</p>
                            
                            <div class="highlight-box">
                                <p><strong>✓ 市場追價意願 {{ chase_willingness }}</strong></p>
                                <p><strong>✓ 今天走勢高機率是「{{ expected_pattern }}」</strong></p>
                                <p>目的是讓選擇權的權利金（IV）雙殺，回歸到莊家設定的區間。</p>
                            </div>

                            <p>這種情況下，我不會貿然追高或搶短，而是耐心等待莊家露出底牌。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Intraday Observation -->
            <div class="section">
                <div class="analysis-section">
                    <h3 class="analysis-title">
                        <span>👀</span>今日 ({{ settlement_date }}) 操作觀察重點
                    </h3>

                    <div class="scenario-prediction">
                        <div class="prediction-card">
                            <div class="prediction-header">
                                <div class="prediction-title">🔔 開盤位階</div>
                            </div>
                            <div class="prediction-detail">
                                若開在 <strong>{{ opening_ref_price }}</strong> 附近，代表多空平衡。<br><br>
                                <strong>偏高開：</strong>注意是否為誘多，觀察 30 分鐘內能否守住。<br>
                                <strong>偏低開：</strong>留意是否測試支撐後反彈。
                            </div>
                        </div>

                        <div class="prediction-card">
                            <div class="prediction-header">
                                <div class="prediction-title">⏰ 最後 30 分鐘</div>
                                <div class="prediction-prob">關鍵時刻</div>
                            </div>
                            <div class="prediction-detail">
                                <strong>13:00 - 13:30</strong><br><br>
                                台指結算價是採<strong>現貨最後半小時的平均價</strong>。<br><br>
                                如果價格接近 {{ key_strike_price }}，莊家可能會試圖將價格壓在此之下或拉上此位，以決定哪些履約價的選擇權會歸零。
                            </div>
                        </div>

                        <div class="prediction-card">
                            <div class="prediction-header">
                                <div class="prediction-title">🎲 預期結算價</div>
                                <div class="prediction-prob">高機率</div>
                            </div>
                            <div class="prediction-detail">
                                落在 <strong>{{ ai_settlement_range }}</strong><br><br>
                                這個區間讓莊家兩邊的權利金收益最大化，同時避免單邊出現過大履約壓力。
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trading Tips -->
            <div class="section">
                <div class="trading-tips">
                    <div class="tips-title">
                        <span>💡</span>實戰小叮嚀
                    </div>

                    <div class="tip-item">
                        <strong>時間價值流逝加速：</strong><br>
                        因為 IV（隱含波動率）昨天是上升的，這代表今天即便指數不動，選擇權的價格也會因為「時間價值流逝」與「波動率回落」而縮水很快。結算日的 Theta Decay（時間價值衰減）是最兇猛的。
                    </div>

                    <div class="tip-item">
                        <strong>如果您手上有 {{ contract_month }} 近月部位：</strong><br>
                        建議早盤若有衝高至 <strong>{{ exit_level_high }}</strong> 以上，可考慮先行平倉，不一定要賭到最後結算。因為莊家守 {{ resistance_key_level }} 的決心很強，繼續持有風險報酬比不划算。
                    </div>

                    <div class="tip-item">
                        <strong>如果您想進場：</strong><br>
                        結算日當天當沖風險較大，建議觀察結算後的<strong>新月份（{{ next_month_1 }} 全月或 {{ next_month_2 }}）</strong>籌碼重新布局。新月份的 OI 分布會更清晰地反映市場對未來走勢的預期。
                    </div>

                    <div class="tip-item">
                        <strong>留意黑天鵝事件：</strong><br>
                        雖然籌碼面給出明確的區間預測，但若出現重大國際消息（如美股暴漲暴跌、地緣政治突發事件），一切技術分析都會失效。<strong>務必設好停損</strong>，不要過度自信。
                    </div>
                </div>
            </div>

            <!-- Conclusion -->
            <div class="section">
                <div class="analysis-section">
                    <h3 class="analysis-title">
                        <span>📝</span>總結：我的結算日策略
                    </h3>

                    <div class="analysis-block">
                        <div class="block-content">
                            <p style="font-size: 1.1rem; line-height: 1.9;">
                                作為一個在市場打滾多年的老手，<strong>我不會在結算日冒險追高殺低</strong>。今天的策略很簡單：
                            </p>

                            <div class="highlight-box">
                                <p><strong>1️⃣ 持倉部位：</strong>看到接近上檔壓力 {{ resistance_key_level }} 就減碼，落袋為安</p>
                                <p><strong>2️⃣ 新進場：</strong>等結算後再說，不急於一時</p>
                                <p><strong>3️⃣ 觀察重點：</strong>最後 30 分鐘的價格行為，這會告訴我下個月的方向</p>
                            </div>

                            <p style="font-size: 1.1rem; margin-top: 20px;">
                                記住，<strong>市場永遠是對的，我們只是順勢而為</strong>。莊家布下的籌碼陷阱已經很明顯了，我們要做的就是不要成為被收割的韭菜。保護本金，等待更好的機會，這才是長期獲利的王道。
                            </p>

                            <div class="conclusion-box" style="margin-top: 20px;">
                                <p style="font-size: 1.05rem;"><strong>祝大家操作順利，結算日平安！</strong> 🍀</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- End AI Analysis Tab -->

        <!-- Trader View Tab -->
        <div id="trader-view-tab" class="tab-content">
            {% if settlement_trader_analysis %}
            
            <!-- 經驗等級 & 學習進度 - 重新設計 -->
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
                <!-- 標題居中 -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; font-size: 1.8rem;">{{ settlement_trader_analysis.level_icon }} AI 交易員視角</h2>
                    <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 1rem;">經驗等級: {{ settlement_trader_analysis.experience_level }}</p>
                </div>
                <!-- 學習進度滿版 -->
                <div style="background: rgba(255,255,255,0.1); padding: 15px 20px; border-radius: 8px; backdrop-filter: blur(10px); text-align: center;">
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 5px;">📚 學習進度</div>
                    <div style="font-size: 1.1rem; font-weight: 600; white-space: pre-line;">{{ settlement_trader_analysis.learning_summary }}</div>
                </div>
            </div>

            <!-- 關鍵數據概覽 -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">📊</span>
                    <h2 class="section-title">結算日關鍵數據</h2>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px;">結算日期</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">{{ settlement_date }}</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px;">當前價格</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">{{ current_price }}</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px;">預測區間</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--purple-color);">{{ predicted_lower }} - {{ predicted_upper }}</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px;">趨勢強度</div>
                        <div style="font-size: 1.5rem; font-weight: 700;">{{ strength_stars }}</div>
                    </div>
                </div>
            </div>

            <!-- 我對結算日的看法（第一人稱） -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">👁️</span>
                    <h2 class="section-title">我對結算日的看法</h2>
                </div>
                <div style="background: white; padding: 30px; border-radius: 12px; border-left: 4px solid var(--primary-color); box-shadow: 0 4px 12px rgba(0,0,0,0.08); line-height: 1.9; white-space: pre-wrap; font-size: 1.05rem;">{{ settlement_trader_analysis.settlement_outlook }}</div>
            </div>

            <!-- 我的結算日策略（第一人稱） -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">🎯</span>
                    <h2 class="section-title">我的結算日策略</h2>
                </div>
                <div style="background: white; padding: 30px; border-radius: 12px; border-left: 4px solid #10b981; box-shadow: 0 4px 12px rgba(0,0,0,0.08); line-height: 1.9; white-space: pre-wrap; font-size: 1.05rem;">{{ settlement_trader_analysis.settlement_strategy }}</div>
            </div>

            <!-- 我最擔心的風險（第一人稱） -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">⚠️</span>
                    <h2 class="section-title">我最擔心的風險</h2>
                </div>
                <div style="background: #fef2f2; padding: 30px; border-radius: 12px; border-left: 4px solid #ef4444; box-shadow: 0 4px 12px rgba(0,0,0,0.08); line-height: 1.9; white-space: pre-wrap; font-size: 1.05rem;">{{ settlement_trader_analysis.settlement_risks }}</div>
            </div>

            <!-- 我的執行計劃（第一人稱） -->
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">📋</span>
                    <h2 class="section-title">我的執行計劃</h2>
                </div>
                <div style="background: white; padding: 30px; border-radius: 12px; border-left: 4px solid #f59e0b; box-shadow: 0 4px 12px rgba(0,0,0,0.08); line-height: 1.9; white-space: pre-wrap; font-size: 1.05rem;">{{ settlement_trader_analysis.execution_plan }}</div>
            </div>

            <!-- 過往結算日經驗 -->
            {% if settlement_trader_analysis.historical_insights %}
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">📚</span>
                    <h2 class="section-title">從過往結算日學到的</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    {% for insight in settlement_trader_analysis.historical_insights %}
                    <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                        <p style="margin: 0; font-style: italic; font-size: 1.05rem; line-height: 1.7;">💡 {{ insight }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- 相似案例參考 -->
            {% if settlement_trader_analysis.similar_cases > 0 %}
            <div style="margin-top: 20px; padding: 25px; background: #f0fdf4; border-radius: 12px; border: 2px solid #86efac; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <p style="margin: 0; color: #166534; font-size: 1.1rem;">
                    📊 在我的記憶中，找到 <strong style="font-size: 1.3rem; color: #15803d;">{{ settlement_trader_analysis.similar_cases }}</strong> 個類似的結算日情境可供參考
                </p>
            </div>
            {% endif %}

            <!-- 總結與提醒 -->
            <div style="margin-top: 30px; padding: 30px; background: linear-gradient(135deg, #f3f4f6, #e5e7eb); border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <p style="font-style: italic; color: var(--text-muted); font-size: 1.05rem; line-height: 1.8;">
                    🧑‍💼 以上是我作為 AI 交易員對這次結算日的個人看法與計劃<br>
                    結算日往往充滿變數，我會持續觀察市場並靈活調整策略<br>
                    <strong style="color: var(--danger-color);">記住：保護本金永遠是第一優先！</strong>
                </p>
            </div>

            {% else %}
            <div class="section">
                <div style="background: white; padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                    <p style="font-size: 1.2rem; color: var(--text-muted);">AI 交易員視角功能尚未啟用</p>
                </div>
            </div>
            {% endif %}
        </div>
        <!-- End Trader View Tab -->

        <!-- Settlement Review Tab -->
        <div id="settlement-review-tab" class="tab-content">
            
            <!-- AI Performance Overview - 重新設計為橫排緊湊格式 -->
            {% if ai_performance and ai_performance.statistics.total_predictions > 0 %}
            <div class="section" style="background: linear-gradient(135deg, #dbeafe 0%, #3b82f6 100%);">
                <div class="section-header" style="border-bottom-color: rgba(30, 64, 175, 0.2);">
                    <span class="section-icon">📈</span>
                    <h2 class="section-title" style="color: #1e40af;">AI 預測績效總覽</h2>
                </div>
                
                <!-- 統計數據 - 橫排格式 -->
                <div style="display: grid; gap: 12px; margin-bottom: 20px;">
                    <div style="background: rgba(255, 255, 255, 0.95); padding: 12px 15px; border-radius: 8px; border-left: 4px solid #3b82f6; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 0.85rem; color: #1e40af; font-weight: 600;">📊 總預測次數：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #2563eb; margin-left: 8px;">{{ ai_performance.statistics.total_predictions }}</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #60a5fa;">累積經驗</div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.95); padding: 12px 15px; border-radius: 8px; border-left: 4px solid #10b981; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 0.85rem; color: #065f46; font-weight: 600;">✅ 平均準確度：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #059669; margin-left: 8px;">{{ ai_performance.statistics.avg_accuracy }}%</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #34d399;">整體表現</div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.95); padding: 12px 15px; border-radius: 8px; border-left: 4px solid #f59e0b; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 0.85rem; color: #92400e; font-weight: 600;">📏 平均誤差：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #d97706; margin-left: 8px;">{{ ai_performance.statistics.avg_price_error|round(1) }}</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #fbbf24;">點數</div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.95); padding: 12px 15px; border-radius: 8px; border-left: 4px solid #8b5cf6; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 0.85rem; color: #5b21b6; font-weight: 600;">🎯 區間命中率：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #7c3aed; margin-left: 8px;">{{ ai_performance.statistics.range_success_rate }}%</span>
                        </div>
                        <div style="font-size: 0.75rem; color: #a78bfa;">預測精準度</div>
                    </div>
                </div>
                
                <!-- Best Prediction - 橫排格式 -->
                {% if ai_performance.best_prediction %}
                <div style="background: rgba(255, 255, 255, 0.95); padding: 15px; border-radius: 8px; border-left: 4px solid #fbbf24;">
                    <div style="font-size: 0.9rem; color: #92400e; margin-bottom: 10px; font-weight: 600;">⭐ 最佳預測記錄</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                        <div style="flex: 1; min-width: 100px;">
                            <span style="font-size: 0.75rem; color: #78716c;">日期：</span>
                            <span style="font-size: 0.95rem; font-weight: 600; color: #1c1917; margin-left: 5px;">{{ ai_performance.best_prediction.date }}</span>
                        </div>
                        <div style="flex: 1; min-width: 100px;">
                            <span style="font-size: 0.75rem; color: #78716c;">誤差：</span>
                            <span style="font-size: 0.95rem; font-weight: 600; color: #059669; margin-left: 5px;">{{ ai_performance.best_prediction.price_error }} 點</span>
                        </div>
                        <div style="flex: 1; min-width: 100px;">
                            <span style="font-size: 0.75rem; color: #78716c;">準確度：</span>
                            <span style="font-size: 0.95rem; font-weight: 600; color: #2563eb; margin-left: 5px;">{{ ai_performance.best_prediction.accuracy }}%</span>
                        </div>
                        <div style="flex: 1; min-width: 100px;">
                            <span style="font-size: 0.75rem; color: #78716c;">評分：</span>
                            <span style="font-size: 0.95rem; font-weight: 600; color: #7c3aed; margin-left: 5px;">{{ ai_performance.best_prediction.score }}</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- AI Settlement Prediction -->
            {% if ai_settlement_prediction %}
            <div class="section" style="background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%); color: #78350f;">
                <div class="section-header" style="border-bottom-color: rgba(120, 53, 15, 0.2);">
                    <span class="section-icon">🔮</span>
                    <h2 class="section-title" style="color: #78350f;">結算日AI預測 {{ ai_level_icon }}</h2>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #92400e; margin-bottom: 15px; font-size: 1.3rem;">📊 趨勢分析 ({{ ai_settlement_prediction.settlement_weekday_zh }}結算)</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 0.85rem; color: #78350f; margin-bottom: 5px;">趨勢方向</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #92400e;">{{ ai_settlement_prediction.trend_analysis.trend_direction }}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 0.85rem; color: #78350f; margin-bottom: 5px;">價格變化</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #92400e;">{{ ai_settlement_prediction.trend_analysis.price_change }}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 0.85rem; color: #78350f; margin-bottom: 5px;">動能評分</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #92400e;">{{ ai_settlement_prediction.trend_analysis.momentum }}/10</div>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #92400e; margin-bottom: 15px; font-size: 1.3rem;">🎯 結算價預測</h3>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 2.5rem; font-weight: 700; color: #92400e; margin-bottom: 10px;">
                            {{ ai_settlement_prediction.settlement_price_prediction.predicted_price | format_number }} 點
                        </div>
                        <div style="font-size: 1.1rem; color: #78350f;">
                            預測區間: {{ ai_settlement_prediction.settlement_price_prediction.lower_bound | format_number }} - 
                            {{ ai_settlement_prediction.settlement_price_prediction.upper_bound | format_number }}
                        </div>
                        <div style="font-size: 0.95rem; color: #a16207; margin-top: 10px;">
                            預期變化: {{ ai_settlement_prediction.settlement_price_prediction.expected_change }}
                        </div>
                    </div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #92400e; margin-bottom: 15px; font-size: 1.3rem;">📋 情境分析</h3>
                    {% for scenario in ai_settlement_prediction.scenarios %}
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #f59e0b;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600; color: #92400e; font-size: 1.1rem;">{{ scenario.name }}</span>
                            <span style="background: #fef3c7; padding: 4px 12px; border-radius: 12px; font-weight: 600; color: #78350f;">
                                {{ scenario.probability }}%
                            </span>
                        </div>
                        <p style="color: #78350f; margin: 0;">{{ scenario.description }}</p>
                    </div>
                    {% endfor %}
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #92400e; margin-bottom: 15px; font-size: 1.3rem;">💡 我的結算展望</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; border: 2px solid #fbbf24; white-space: pre-line; color: #78350f; line-height: 1.8;">{{ ai_settlement_prediction.outlook }}</div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px;">
                    <h3 style="color: #92400e; margin-bottom: 15px; font-size: 1.3rem;">⚙️ 結算策略建議</h3>
                    <div style="display: grid; gap: 15px;">
                        <!-- 結算前準備 -->
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #fbbf24;">
                            <div style="font-weight: 600; color: #92400e; margin-bottom: 10px; font-size: 1.05rem;">🕐 結算前準備</div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">時機：</span>{{ ai_settlement_prediction.strategy_recommendation.before_settlement.timing }}
                            </div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">動作：</span>{{ ai_settlement_prediction.strategy_recommendation.before_settlement.action }}
                            </div>
                            <div style="color: #dc2626;">
                                <span style="font-weight: 500;">⚠️ 注意：</span>{{ ai_settlement_prediction.strategy_recommendation.before_settlement.caution }}
                            </div>
                        </div>
                        
                        <!-- 結算當下 -->
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <div style="font-weight: 600; color: #92400e; margin-bottom: 10px; font-size: 1.05rem;">⚡ 結算當下</div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">時機：</span>{{ ai_settlement_prediction.strategy_recommendation.during_settlement.timing }}
                            </div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">動作：</span>{{ ai_settlement_prediction.strategy_recommendation.during_settlement.action }}
                            </div>
                            <div style="color: #dc2626;">
                                <span style="font-weight: 500;">⚠️ 注意：</span>{{ ai_settlement_prediction.strategy_recommendation.during_settlement.caution }}
                            </div>
                        </div>
                        
                        <!-- 倉位管理 -->
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                            <div style="font-weight: 600; color: #92400e; margin-bottom: 10px; font-size: 1.05rem;">📊 倉位管理</div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">🔼 看多時：</span>{{ ai_settlement_prediction.strategy_recommendation.position_management.if_bullish }}
                            </div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">🔽 看空時：</span>{{ ai_settlement_prediction.strategy_recommendation.position_management.if_bearish }}
                            </div>
                            <div style="color: #78350f;">
                                <span style="font-weight: 500;">⚖️ 中性時：</span>{{ ai_settlement_prediction.strategy_recommendation.position_management.if_neutral }}
                            </div>
                        </div>
                        
                        <!-- 風險控制 -->
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">
                            <div style="font-weight: 600; color: #92400e; margin-bottom: 10px; font-size: 1.05rem;">🛡️ 風險控制</div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">⛔ 停損：</span>{{ ai_settlement_prediction.strategy_recommendation.risk_control.stop_loss }}
                            </div>
                            <div style="color: #78350f; margin-bottom: 8px;">
                                <span style="font-weight: 500;">📏 部位大小：</span>{{ ai_settlement_prediction.strategy_recommendation.risk_control.position_size }}
                            </div>
                            <div style="color: #dc2626;">
                                <span style="font-weight: 500;">⏰ 時間價值：</span>{{ ai_settlement_prediction.strategy_recommendation.risk_control.time_decay }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- AI Settlement Review -->
            {% if ai_settlement_review %}
            <div class="section" style="background: linear-gradient(135deg, #ede9fe 0%, #8b5cf6 100%); color: #3b0764;">
                <div class="section-header" style="border-bottom-color: rgba(59, 7, 100, 0.2);">
                    <span class="section-icon">📝</span>
                    <h2 class="section-title" style="color: #3b0764;">結算檢討 {{ ai_settlement_review.score }}</h2>
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #5b21b6; margin-bottom: 15px; font-size: 1.3rem;">📊 準確度分析</h3>
                    <div style="display: grid; gap: 10px;">
                        <div style="background: white; padding: 12px 15px; border-radius: 8px; border-left: 4px solid #8b5cf6; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem; color: #6b21a8; font-weight: 600;">📈 預測準確度：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #5b21b6;">{{ ai_settlement_review.accuracy.overall_accuracy }}%</span>
                        </div>
                        <div style="background: white; padding: 12px 15px; border-radius: 8px; border-left: 4px solid #8b5cf6; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem; color: #6b21a8; font-weight: 600;">📏 價格誤差：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #5b21b6;">{{ ai_settlement_review.accuracy.price_error }} ({{ ai_settlement_review.accuracy.price_error_percent }}%)</span>
                        </div>
                        <div style="background: white; padding: 12px 15px; border-radius: 8px; border-left: 4px solid #8b5cf6; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem; color: #6b21a8; font-weight: 600;">🎯 區間預測：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #5b21b6;">
                                {% if ai_settlement_review.accuracy.in_predicted_range %}✅ 正確{% else %}❌ 失誤{% endif %}
                            </span>
                        </div>
                        <div style="background: white; padding: 12px 15px; border-radius: 8px; border-left: 4px solid #8b5cf6; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem; color: #6b21a8; font-weight: 600;">🧭 方向判斷：</span>
                            <span style="font-size: 1.2rem; font-weight: 700; color: #5b21b6;">
                                {% if ai_settlement_review.accuracy.direction_correct %}✅ 正確{% else %}❌ 失誤{% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #5b21b6; margin-bottom: 15px; font-size: 1.3rem;">💭 自我反思</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; border: 2px solid #8b5cf6; white-space: pre-line; color: #3b0764; line-height: 1.8;">{{ ai_settlement_review.self_reflection }}</div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                    <h3 style="color: #5b21b6; margin-bottom: 15px; font-size: 1.3rem;">📚 學到的教訓</h3>
                    {% for lesson in ai_settlement_review.lessons_learned %}
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #8b5cf6;">
                        <p style="color: #3b0764; margin: 0;">{{ lesson }}</p>
                    </div>
                    {% endfor %}
                </div>

                <div style="background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 25px;">
                    <h3 style="color: #5b21b6; margin-bottom: 15px; font-size: 1.3rem;">🎯 改進方向</h3>
                    {% for improvement in ai_settlement_review.improvement_areas %}
                    <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #8b5cf6;">
                        <p style="color: #3b0764; margin: 0;">{{ improvement }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- No Review Yet -->
            <div class="section">
                <div style="background: white; padding: 40px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                    <p style="font-size: 1.5rem; color: var(--text-muted); margin-bottom: 10px;">⏳</p>
                    <p style="font-size: 1.2rem; color: var(--text-muted);">結算日尚未結束，檢討報告將在結算後生成</p>
                </div>
            </div>
            {% endif %}
        </div>
        <!-- End Settlement Review Tab -->

        <!-- Footer -->
        <footer>
            <p>本報告基於歷史數據與技術分析，僅供參考，不構成投資建議</p>
            <div class="footer-links">
                <a href="https://github.com/ShoppingLiao/taiex-options-analyzer" target="_blank">GitHub 專案</a>
            </div>
        </footer>
    </div>

    <script>
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            if (tabName === 'technical') {
                document.getElementById('technical-tab').classList.add('active');
                document.querySelectorAll('.tab-button')[0].classList.add('active');
            } else if (tabName === 'ai-analysis') {
                document.getElementById('ai-analysis-tab').classList.add('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
            } else if (tabName === 'trader-view') {
                document.getElementById('trader-view-tab').classList.add('active');
                document.querySelectorAll('.tab-button')[2].classList.add('active');
            } else if (tabName === 'settlement-review') {
                document.getElementById('settlement-review-tab').classList.add('active');
                document.querySelectorAll('.tab-button')[3].classList.add('active');
            }
        }
    </script>
</body>
</html>
