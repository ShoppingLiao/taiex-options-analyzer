# PDF åº§æ¨™è§£æè§£æ±ºæ–¹æ¡ˆè¨˜éŒ„

**æ—¥æœŸ**: 2026 å¹´ 1 æœˆ 15 æ—¥
**å•é¡Œå ±å‘Š**: æŸäº› PDF æ–‡å­—è§£æå¤±æ•—ï¼Œå°è‡´é¸æ“‡æ¬Š OI æ•¸æ“šç„¡æ³•æå–

---

## ğŸ› å•é¡Œæè¿°

20260115 çš„ PDF åœ¨è§£ææ™‚ï¼Œåªèƒ½æå–è¿‘æœˆé¸æ“‡æ¬Šï¼ˆPage 8ï¼‰çš„æ•¸æ“šï¼Œé€±ä¸‰é¸æ“‡æ¬Šï¼ˆPage 6ï¼‰å’Œé€±äº”é¸æ“‡æ¬Šï¼ˆPage 7ï¼‰è§£æå¤±æ•—ã€‚

### åŸå› åˆ†æ

æŸäº›æ—¥æœŸçš„ PDFï¼ˆå¦‚ 20260115ï¼‰æ–‡å­—æå–æ™‚ï¼Œæ•¸å­—æœƒè¢«åˆ†é›¢æˆå–®ç¨çš„å­—å…ƒï¼š

```
# æ­£å¸¸ PDF (å¦‚ 20260114) æ–‡å­—æå–çµæœ
0 0 29,000 547 66

# å•é¡Œ PDF (å¦‚ 20260115) æ–‡å­—æå–çµæœ
2 0 2 8 2 ,5 8 5 1 ,4 9 3
```

é€™å°è‡´ `_parse_options_page()` ä¸­çš„æ•¸å­—æ­£å‰‡åŒ¹é…å¤±æ•ˆã€‚

---

## âœ… è§£æ±ºæ–¹æ¡ˆï¼šåº§æ¨™è§£æ

### æ ¸å¿ƒæ¦‚å¿µ

ä½¿ç”¨ `pdfplumber` çš„ `extract_words()` æ–¹æ³•å–å¾—æ¯å€‹æ–‡å­—å€å¡Šçš„åº§æ¨™ä½ç½®ï¼ˆx, yï¼‰ï¼Œç„¶å¾Œï¼š
1. æŒ‰ Y åº§æ¨™åˆ†çµ„ï¼ˆåŒä¸€è¡Œçš„æ•¸æ“šï¼‰
2. æŒ‰ X åº§æ¨™ç¯„åœåˆ¤æ–·æ¬„ä½ï¼ˆå“ªä¸€åˆ—çš„æ•¸æ“šï¼‰
3. åˆä½µåŒæ¬„ä½çš„æ•¸å­—

### å¯¦ä½œä»£ç¢¼

#### 1. æ–°å¢é é¢é…ç½® (`src/parser.py`)

```python
# å›ºå®šé é¢å°æ‡‰é—œä¿‚ (0-indexed)
PAGE_CONFIG = {
    5: {'type': 'weekly_wed', 'name': 'é€±ä¸‰é¸æ“‡æ¬Š'},  # Page 6
    6: {'type': 'weekly_fri', 'name': 'é€±äº”é¸æ“‡æ¬Š'},  # Page 7
    7: {'type': 'monthly', 'name': 'è¿‘æœˆé¸æ“‡æ¬Š'},     # Page 8
}

# X åº§æ¨™ç¯„åœå®šç¾©ï¼ˆç”¨æ–¼åº§æ¨™è§£ææ¨¡å¼ï¼‰
X_RANGES = {
    'call_oi_change': (50, 100),   # å·¦å´ç¬¬ä¸€æ¬„
    'call_oi': (100, 200),          # å·¦å´ç¬¬äºŒæ¬„
    'strike': (230, 300),           # ä¸­é–“å±¥ç´„åƒ¹
    'put_oi': (420, 490),           # å³å´ç¬¬ä¸€æ¬„
    'put_oi_change': (490, 550),    # å³å´ç¬¬äºŒæ¬„
}
```

#### 2. åº§æ¨™è§£ææ–¹æ³• (`_parse_options_page_by_coords`)

```python
def _parse_options_page_by_coords(self, page, trade_date: str, config: Dict) -> Optional[OptionsData]:
    """ä½¿ç”¨åº§æ¨™æ–¹å¼è§£æé¸æ“‡æ¬Šé é¢ï¼ˆç”¨æ–¼è™•ç†ç‰¹æ®Šæ ¼å¼çš„ PDFï¼‰"""
    words = page.extract_words()

    # æŒ‰ Y åº§æ¨™åˆ†çµ„ï¼ˆæ¯3åƒç´ ä¸€çµ„ï¼Œå…è¨±è¼•å¾®åå·®ï¼‰
    rows = {}
    for word in words:
        y = round(word['top'] / 3) * 3
        if y not in rows:
            rows[y] = []
        rows[y].append((word['x0'], word['text']))

    # è§£ææ¯ä¸€è¡Œï¼Œæ ¹æ“š X åº§æ¨™åˆ¤æ–·æ¬„ä½
    for y, words_in_row in sorted(rows.items()):
        col_data = {col: [] for col in self.X_RANGES}

        for x, text in words_in_row:
            for col_name, (x_min, x_max) in self.X_RANGES.items():
                if x_min <= x < x_max:
                    col_data[col_name].append(text)
                    break

        # åˆä½µæ•¸å­—ä¸¦è™•ç†...
```

#### 3. è‡ªå‹•åˆ‡æ›æ©Ÿåˆ¶ (`parse` æ–¹æ³•)

```python
# å…ˆå˜—è©¦æ–‡å­—è§£æ
options_data = self._parse_options_page(text, trade_date, config)

# å¦‚æœæ–‡å­—è§£æå¤±æ•—æˆ–æ•¸æ“šä¸è¶³ï¼Œå˜—è©¦åº§æ¨™è§£æ
if not options_data or len(options_data.strike_prices) < 5:
    print(f"âš ï¸  Page {page_idx + 1} ({config['name']}) æ–‡å­—è§£æå¤±æ•—ï¼Œå˜—è©¦åº§æ¨™è§£æ...")
    options_data = self._parse_options_page_by_coords(page, trade_date, config)
```

---

## ğŸ“Š æ¸¬è©¦çµæœ

### ä¿®æ”¹å‰

```
0114: æ‰¾åˆ° 3 çµ„è³‡æ–™ âœ…
0115: æ‰¾åˆ° 1 çµ„è³‡æ–™ âŒ (åªæœ‰è¿‘æœˆé¸æ“‡æ¬Š)
```

### ä¿®æ”¹å¾Œ

```
0114: æ‰¾åˆ° 3 çµ„è³‡æ–™ âœ…
0115: æ‰¾åˆ° 3 çµ„è³‡æ–™ âœ…

è©³ç´°è¼¸å‡ºï¼š
âœ… Page 6 (é€±ä¸‰é¸æ“‡æ¬Š): æ‰¾åˆ° 35 ç­†æ•¸æ“š
âœ… Page 7 (é€±äº”é¸æ“‡æ¬Š): æ‰¾åˆ° 30 ç­†æ•¸æ“š
âœ… Page 8 (è¿‘æœˆé¸æ“‡æ¬Š): æ‰¾åˆ° 28 ç­†æ•¸æ“š
```

---

## ğŸ“‹ å¾ŒçºŒç¶­è­·æ³¨æ„äº‹é …

### 1. é é¢å°æ‡‰å¯èƒ½è®Šæ›´

å¦‚æœ PDF æ ¼å¼è®Šæ›´ï¼ˆä¾‹å¦‚é¸æ“‡æ¬Šæ•¸æ“šç§»åˆ°å…¶ä»–é é¢ï¼‰ï¼Œéœ€è¦ä¿®æ”¹ `PAGE_CONFIG`ï¼š

```python
PAGE_CONFIG = {
    5: {'type': 'weekly_wed', 'name': 'é€±ä¸‰é¸æ“‡æ¬Š'},  # ä¿®æ”¹é ç¢¼
    6: {'type': 'weekly_fri', 'name': 'é€±äº”é¸æ“‡æ¬Š'},
    7: {'type': 'monthly', 'name': 'è¿‘æœˆé¸æ“‡æ¬Š'},
}
```

### 2. X åº§æ¨™ç¯„åœå¯èƒ½è®Šæ›´

å¦‚æœè¡¨æ ¼æ¬„ä½å¯¬åº¦æ”¹è®Šï¼Œéœ€è¦èª¿æ•´ `X_RANGES`ï¼š

```python
X_RANGES = {
    'call_oi_change': (50, 100),   # èª¿æ•´åº§æ¨™ç¯„åœ
    'call_oi': (100, 200),
    'strike': (230, 300),
    'put_oi': (420, 490),
    'put_oi_change': (490, 550),
}
```

### 3. èª¿è©¦åº§æ¨™

å¦‚éœ€é‡æ–°èª¿æ•´åº§æ¨™ç¯„åœï¼Œå¯ç”¨ä»¥ä¸‹ä»£ç¢¼æ¸¬è©¦ï¼š

```python
import pdfplumber

with pdfplumber.open('data/pdf/æœŸè²¨é¸æ“‡æ¬Šç›¤å¾Œæ—¥å ±_YYYYMMDD.pdf') as pdf:
    page = pdf.pages[5]  # Page 6
    words = page.extract_words()

    for word in words[:50]:  # æŸ¥çœ‹å‰ 50 å€‹å­—
        print(f"x={word['x0']:.1f}, y={word['top']:.1f}: {word['text']}")
```

---

## ğŸ”— ç›¸é—œæª”æ¡ˆ

- `src/parser.py` - PDF è§£æå™¨ä¸»ç¨‹å¼
- `documentation/issues/ISSUE_PDF_PARSING_20260112.md` - ä¹‹å‰çš„ç›¸é—œå•é¡Œè¨˜éŒ„

---

**ç‹€æ…‹**: âœ… å·²è§£æ±º
**å½±éŸ¿ç¯„åœ**: æ‰€æœ‰æ—¥æœŸçš„ PDF è§£æ
**è§£æ±ºæ–¹å¼**: åº§æ¨™è§£æè‡ªå‹•åˆ‡æ›æ©Ÿåˆ¶
**è¨˜éŒ„è€…**: Claude
**è¨˜éŒ„æ™‚é–“**: 2026 å¹´ 1 æœˆ 15 æ—¥
